!function(e){e.fn.extend({BlackAndWhite:function(t){"use strict";var n=this,i={};t=e.extend(i,t);var a=t.hoverEffect,r=t.webworkerPath,o=t.invertHoverEffect,s=t.responsive,d="number"==typeof t.intensity&&t.intensity<1&&t.intensity>0?t.intensity:1,c=e.isPlainObject(t.speed)?t.speed.fadeIn:t.speed,f=e.isPlainObject(t.speed)?t.speed.fadeOut:t.speed,u=document.all&&!window.opera&&window.XMLHttpRequest?!0:!1,m=" -webkit- -moz- -o- -ms- ".split(" "),g={},h=function(e){if(g[e]||""===g[e])return g[e]+e;var t=document.createElement("div"),n=["","Moz","Webkit","O","ms","Khtml"];for(var i in n)if("undefined"!=typeof t.style[n[i]+e])return g[e]=n[i],n[i]+e;return e.toLowerCase()},l=function(){var e=document.createElement("div");return e.style.cssText=m.join("filter:blur(2px); "),!!e.style.length&&(void 0===document.documentMode||document.documentMode>9)}(),p=!!document.createElement("canvas").getContext,v=e(window),w=function(){return"undefined"!=typeof Worker?!0:!1}(),y=(h("Filter"),[]),W=w&&r?new Worker(r+"BnWWorker.js"):!1,I=function(t){e(t.currentTarget).find(".BWfade").stop(!0,!0)[o?"fadeOut":"fadeIn"](f)},B=function(t){e(t.currentTarget).find(".BWfade").stop(!0,!0)[o?"fadeIn":"fadeOut"](c)},x=function(e){"function"==typeof t.onImageReady&&t.onImageReady(e)},b=function(){return y.length?(W.postMessage({imgData:y[0].imageData,intensity:d}),W.onmessage=function(e){y[0].ctx.putImageData(e.data,0,0),x(y[0].img),y.splice(0,1),b()},void 0):(W.terminate&&W.terminate(),W.close&&W.close(),void 0)},k=function(e,t,n,i){var a=t.getContext("2d"),r=0;a.drawImage(e,0,0,n,i);var o=a.getImageData(0,0,n,i),s=o.data,c=s.length;if(W)y.push({imageData:o,ctx:a,img:e});else{for(;c>r;r+=4){var f=.3*s[r]+.59*s[r+1]+.11*s[r+2];s[r]=~~(f*d+s[r]*(1-d)),s[r+1]=~~(f*d+s[r+1]*(1-d)),s[r+2]=~~(f*d+s[r+2]*(1-d))}a.putImageData(o,0,0),x(e)}},D=function(t,n){var i=t[0],a=i.src,r=t.width(),o=t.height(),s={};if(p&&!l){var c=i.width,f=i.height;e('<canvas class="BWfade" width="'+c+'" height="'+f+'"></canvas>').prependTo(n);var u=n.find("canvas");u.css(s),k(i,u[0],c,f)}else s[h("Filter")]="grayscale("+100*d+"%)",e("<img src="+a+' width="'+r+'" height="'+o+'" class="BWFilter BWfade" /> ').prependTo(n),e(".BWFilter").css(e.extend(s,{filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)"})),x(i)};return this.init=function(){n.each(function(t,n){var i=e(n),a=i.find("img");a.width()?D(a,i):a.on("load",function(){D(a,i)})}),W&&b(),a&&(n.on("mouseleave",I),n.on("mouseenter",B)),s&&v.on("resize orientationchange",n.resizeImages)},this.resizeImages=function(){n.each(function(t,n){var i=e(n).find("img:not(.BWFilter)"),a=u?e(i).prop("width"):e(i).width(),r=u?e(i).prop("height"):e(i).height();e(this).find(".BWFilter, canvas").css({width:a,height:r})})},this.init(t)}})}(jQuery);